SET LINES 150 PAGES 5000 TIMING ON;
COL TABLESPACE_NAME FOR A20;
COL FILE_NAME FOR A46;
SELECT
  FILE_NAME,D.TABLESPACE_NAME,ROUND(D.BYTES/1024/1024/1024,2)SIZE_GB,SUM(NVL(ROUND(E.BYTES/1024/1024/1024,2),0))GB_USED,
  ROUND(SUM(NVL(E.BYTES,0)) / (D.BYTES), 4) * 100 AS PERCENT_USED,
  ROUND((D.BYTES-NVL(SUM(E.BYTES),0))/1024/1024/1024,2)GB_FREE
FROM DBA_EXTENTS E,	DBA_DATA_FILES D
WHERE D.FILE_ID = E.FILE_ID (+)
GROUP BY FILE_NAME, D.TABLESPACE_NAME, D.FILE_ID, D.BYTES, STATUS
ORDER BY D.TABLESPACE_NAME, D.FILE_ID;
